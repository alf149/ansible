---
  - name: Docker | Deploy | Portainer
    tags: docker_install
    community.docker.docker_container:
      name: portainer
      image: portainer/portainer-ce:latest
      ports:
        - "9000:9000"
      volumes:
        - /var/run/docker.sock:/var/run/docker.sock
        - /portainer/config/portainer/data:/data
      restart_policy: unless-stopped
  
  - name: get file stat to be able to perform check in the following task
    stat: path=/portainer/config/portainer/data/copy.txt
    register: portainer_file

  - name: Docker | Stop | Portainer
    tags: docker_install
    community.docker.docker_container:
      name: portainer
      image: portainer/portainer-ce:latest
      state: stopped
    when: not portainer_file.stat.exists
  
  - name: Docker | Homer | config files
    tags: docker_install
    copy:
      src: files/{{ item.src }}
      dest: /{{ item.dest }}
      owner: root
      group: root
      mode: 0600
    with_items:
      - { src: 'portainer/portainer.db', dest: 'portainer/config/portainer/data/portainer.db' }
      - { src: 'portainer/copy.txt', dest: 'portainer/config/portainer/data/copy.txt' }
    when: not portainer_file.stat.exists
  
  - name: Docker | Restart | Portainer
    tags: docker_install
    community.docker.docker_container:
      name: portainer
      image: portainer/portainer-ce:latest
      restart: yes
    when: not portainer_file.stat.exists