---
#
# Tasks and roles for all hosts
#
- hosts: all
  gather_facts: yes
  become: yes

  pre_tasks:
    - name: update debian chache.
      apt:
        update_cache: true
        cache_valid_time: 3600
      when: ansible_os_family | lower == "debian"
  
  roles:
    - system
    - geerlingguy.security
    - geerlingguy.ntp
    
    - role: geerlingguy.pip
      tags:
        - containers
      when: enable_portainer or enable_watchtower or enable_pihole
      
    - role: geerlingguy.docker
      tags:
        - containers
      when: enable_portainer or enable_watchtower or enable_pihole
             
    - role: security/ufw
      tags:
        - ufw
        - security
      when: enable_ufw | default(False)

    - role: security/crowdsec
      tags:
        - crowdsec
        - security
      when: enable_crowdsec | default(False)

    - role: containers/portainer
      tags:
        - portainer
        - containers
      when: enable_portainer | default(False)

    - role: containers/watchtower
      tags:
        - watchtower
        - containers
      when: enable_watchtower | default(False)
      
    - role: containers/pihole
      tags:
        - pihole 
        - containers
      when: enable_pihole | default(False)
    
    - role: containers/wireguard
      tags: 
        - wireguard
        - containers
      when: enable_wireguard | default(False)

    
                
    

