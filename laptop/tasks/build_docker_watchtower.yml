---
  - name: docker | Deploy | Watchtower
    tags: docker_install
    community.docker.docker_container:
      name: watchtower
      image: containrrr/watchtower:latest
      command: --schedule "0 0 4 * * *" --debug
      volumes:
        - /var/run/docker.sock:/var/run/docker.sock
      restart_policy: unless-stopped
  
  - name: Docker | Archive | Watchtower - container image as a tarball exists
    tags: docker_archive_images
    stat:
      path: /home/deploy/backup/{{ ansible_date_time.date }}_watchtower_latest.tar
    register: watchtower_backup_file
  
  - name: Docker | Archive | Watchtower -  image as a tarball
    tags: docker_archive_images
    docker_image:
      name: containrrr/watchtower:latest
      archive_path: /home/deploy/backup/{{ ansible_date_time.date }}_watchtower_latest.tar
      source: pull
      state: present
    when: not watchtower_backup_file.stat.exists
